<div class="logs-container">
  <div class="card">
    <div class="font-semibold text-xl mb-4">Loglar</div>
    <p-table
      #dt1
      [value]="logs"
      dataKey="id"
      [lazy]="true"
      (onLazyLoad)="onPageChange($event)"
      [loading]="loading"
      [paginator]="true"
      [rows]="rows"
      [totalRecords]="totalRecords"
      [first]="first"
      [rowsPerPageOptions]="[25, 50, 100]"
      [rowHover]="true"
      [showGridlines]="true"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="caption">
        <div class="flex justify-between items-center flex-column sm:flex-row">
          <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"></button>
          <input pInputText id="logSearchInput" type="text" placeholder="Search keyword" class="ml-auto" />
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th style="min-width: 100px">
            <div class="flex justify-between items-center">
              ID
              <p-columnFilter type="text" field="id" display="menu" placeholder="Search by ID"></p-columnFilter>
            </div>
          </th>
          <th style="min-width: 120px">
            <div class="flex justify-between items-center">
              Tarih
              <p-columnFilter type="date" field="logged" display="menu" placeholder="mm/dd/yyyy"></p-columnFilter>
            </div>
          </th>
          <th style="min-width: 100px">
            <div class="flex justify-between items-center">
              Seviye
              <p-columnFilter field="level" matchMode="equals" display="menu"></p-columnFilter>
            </div>
          </th>
          <th style="min-width: 12rem">
            <div class="flex justify-between items-center">
              Mesaj
              <p-columnFilter type="text" field="message" display="menu" placeholder="Search by message"></p-columnFilter>
            </div>
          </th>
          <th style="min-width: 200px">
            <div class="flex justify-between items-center">
              Logger
              <p-columnFilter type="text" field="logger" display="menu" placeholder="Search by logger"></p-columnFilter>
            </div>
          </th>
          <th style="min-width: 100px">İşlem</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-log>
        <tr>
          <td>{{ log.id }}</td>
          <td>{{ formatDate(log.logged) }}</td>
          <td>
            <p-tag [value]="log.level" [severity]="getSeverity(log.level)"></p-tag>
          </td>
          <td>
            <div class="log-message" [title]="log.message">
              {{ log.message.length > 100 ? log.message.substring(0, 100) + '...' : log.message }}
            </div>
          </td>
          <td>
            <small>{{ log.logger || '-' }}</small>
          </td>
          <td>
            <p-button 
              icon="pi pi-eye" 
              [text]="true"
              (onClick)="viewLog(log)"
              severity="info"
              [rounded]="true">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center p-4">
            Log kaydı bulunamadı.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Log Detail Dialog -->
  <p-dialog 
    [(visible)]="dialogVisible" 
    [modal]="true"
    [style]="{width: '80vw', maxWidth: '900px'}"
    [draggable]="false"
    [resizable]="false"
    header="Log Detayı">
    
    <div *ngIf="selectedLog" class="log-detail">
      <div class="detail-row">
        <label>ID:</label>
        <span>{{ selectedLog?.id }}</span>
      </div>
      
      <div class="detail-row">
        <label>Uygulama:</label>
        <span>{{ selectedLog?.application }}</span>
      </div>
      
      <div class="detail-row">
        <label>Tarih:</label>
        <span>{{ formatDate(selectedLog?.logged || '') }}</span>
      </div>
      
      <div class="detail-row">
        <label>Seviye:</label>
        <p-tag *ngIf="selectedLog?.level" [value]="selectedLog.level" [severity]="getSeverity(selectedLog.level)"></p-tag>
      </div>
      
      <div class="detail-row">
        <label>Mesaj:</label>
        <div class="log-message-full">{{ selectedLog?.message }}</div>
      </div>
      
      <div class="detail-row" *ngIf="selectedLog?.logger">
        <label>Logger:</label>
        <span>{{ selectedLog.logger }}</span>
      </div>
      
      <div class="detail-row" *ngIf="selectedLog?.callsite">
        <label>Callsite:</label>
        <code class="callsite">{{ selectedLog.callsite }}</code>
      </div>
      
      <div class="detail-row" *ngIf="selectedLog?.exception">
        <label>Exception:</label>
        <pre class="exception-text">{{ selectedLog.exception }}</pre>
      </div>
      
      <div class="detail-row" *ngIf="selectedLog?.properties">
        <label>Properties:</label>
        <pre class="properties-text">{{ selectedLog.properties }}</pre>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Kapat" 
        icon="pi pi-times"
        (onClick)="dialogVisible = false"
        [text]="true">
      </p-button>
    </ng-template>
  </p-dialog>
</div>

